@using Microsoft.AspNetCore.Mvc.Localization
@inject IViewLocalizer Localizer

@model eSyaEnterprise_UI.Areas.eSyaNatureCure.Models.DO_GuestCheckInDetails
@{
    ViewData["Title"] = "Guest Info";
    Layout = "~/Views/Shared/_Layout.cshtml";
}
<link href="~/css/statusStepper.css" rel="stylesheet" />
<script src="~/js/eSyaNatureCure/GuestDocumentUpload.js"></script>
<script src="~/js/eSyaNatureCure/GuestRescheduling.js"></script>
<script src="~/js/eSyaNatureCure/RoomChange.js"></script>
<script src="~/js/eSyaNatureCure/AddService.js"></script>
<script src="~/js/eSyaNatureCure/GuestPersonalDetails.js"></script>
<script src="~/js/context-menu.js"></script>
<script src="~/js/jquery.contextMenu.min.js"></script>

<link href="~/css/jquery.contextMenu.min.css" rel="stylesheet" />
@{
    var userFormRole = (eSyaEnterprise_UI.Models.DO_UserFormRole)ViewBag.UserFormRole;

}
<script>
    var _userFormRole = JSON.parse('@Html.Raw(Json.Serialize(userFormRole))');

     var localization = {
         Active: '@Localizer["Active"]',
         Actions: '@Localizer["Actions"]',
         Edit: '@Localizer["Edit"]',
         View: '@Localizer["View"]',
         Save: '@Localizer["Save"]',
         Update: '@Localizer["Update"]',
         Delete: '@Localizer["Delete"]',
         Activate: '@Localizer["Activate"]',
         DActivate: '@Localizer["De activate"]',
         EditDocumentUpload: '@Localizer["Edit Document Upload"]',
         AddDocumentUpload: '@Localizer["Add Document Upload"]',
         ViewDocumentUpload: '@Localizer["View Document Upload"]',

    };

</script>


<link href="~/css/eSyaNatureCure.css" rel="stylesheet" />
<style>
    #rs_mjqgAddOnServices, #rs_mjqgActivities {
        display: none;
    }
</style>

<input id="hdBookingKey" type="hidden" value="@Model.BookingKey" />
<input id="hdGuestId" type="hidden" value="@Model.GuestId" />
<input id="hdUHID" type="hidden" value="@Model.UHID" />
<input id="hdPackageId" type="hidden" value="@Model.PackageId" />
<section class="">
    <div class="row m-0">
        <div class="col-lg-3 col-md-6 col-sm-6 main-content-box d-flex align-items-center">
            <span class="box-icon"><i class="fas fa-user-md fa-2x"></i></span>
            <div class="pl-2 d-flex justify-content-around flex-column">
                @if (Model.UHID > 0)
                {
                    <label class=""><span>UHID :</span><span class="text-data"> @Model.UHID</span></label>
                }
                <label class=""><span class="text-data">@Model.FirstName  @Model.LastName  </span></label>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6 main-content-box">
            <div class="d-flex">
                <span class="box-icon"><i class="fas fa-bed fa-2x"></i></span>
                <div class="pl-2 d-flex justify-content-around flex-column">
                    <label class=""><span class="text-data">@Model.PackageDesc</span></label>
                    <label class=""><span class="text-label">Room Type :</span><span class="text-data"> @Model.RoomTypeName</span></label>
                </div>
            </div>
        </div>
        <div class="col-lg-3 col-md-6 col-sm-6 col-6 main-content-box">
            <div class="d-flex">
                <span class="box-icon"><i class="far fa-building fa-2x"></i></span>
                <div class="pl-2 d-flex justify-content-around flex-column">
                    <label class=""><span class="text-label">Room No.:</span><span class="text-data">@Model.RoomNumber</span></label>
                    <label class=""><span class="text-label">Bed No.:</span><span class="text-data">@Model.BedNumber</span></label>
                </div>
            </div>
        </div>


        <div class="col-lg-3 col-md-6 col-sm-6 col-6 main-content-box">
            <div class="d-flex justify-content-evenly">
                <span class="box-icon"><i class="far fa-calendar fa-2x"></i></span>
                <div class="pl-2 d-flex justify-content-around flex-column">
                    <label class=""><span class="text-label">Check-In:</span><span class="text-data" id="txtCheckin">@Model.CheckedInDate.ToString("dd-MMM-yyyy")</span></label>
                    <label class=""><span class="text-label">Check-Out:</span><span class="text-data" id="txtCheckout">@Model.CheckedOutDate.ToString("dd-MMM-yyyy")</span></label>
                </div>
            </div>
        </div>
    </div>
</section>
<section class="tab-content py-1" id="statusInfoSection">
    <div class="row">
        <div class="col-lg-12 p-0" style="display:inline-flex;padding-left: 20px !important;">
            <label>
                Current Status :
            </label>&nbsp;
            <label style="display:none;" id="lblBookingStatus">
                CheckedIn
            </label>
        </div>
    </div>
</section>
<section class="tab-content mt-0">
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 p-0">
                <ul class="nav nav-pills border-bottom" id="myTabCheckIn" role="tablist">
                    <li class="nav-item">
                        <a class="nav-link active" id="personalInfo-tab" data-toggle="tab" href="#tab_personalInfo" role="tab" aria-controls="home" aria-selected="true">Personal Information</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="documentupload-tab" data-toggle="tab" href="#tab_documentupload" role="tab" aria-controls="profile" aria-selected="false" onclick="fnLoadDocumentUpload()">Document Upload</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="guestDetails-tab" data-toggle="tab" href="#tab_guestDetails" role="tab" aria-controls="profile" aria-selected="false">Guest Details</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="intertransfer-tab" data-toggle="tab" href="#tab_IT" role="tab" aria-controls="intertransfer" aria-selected="false" onclick="fnLoadITRescheduling()">Inter Transfer</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="payment-tab" data-toggle="tab" href="#tab_payment" role="tab" aria-controls="profile" aria-selected="false" onclick="fnLoadPaymentDetails()">Payment</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="invoicebilling-tab" data-toggle="tab" href="#tab_invoicebilling" role="tab" aria-controls="profile" aria-selected="false" onclick="fnLoadBillingServices()"> Generate Invoice </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" id="guestcheckout-tab" data-toggle="tab" href="#tab_guestcheckout" role="tab" aria-controls="profile" aria-selected="false" onclick="fnLoadGuestCheckOut()"> Guest Checkout </a>
                    </li>

                </ul>


                <div class="tab-content" id=" myTabCheckInContent">

                    <div class="tab-pane fade show active" id="tab_personalInfo" role="tabpanel" aria-labelledby="personalinfo-tab">
                        <form enctype="multipart/form-data" method="post">
                            <div class="row">
                                @if (Model.IsCheckedIn == false)
                                {
                                    <div class="col-lg-2 col-md-2 col-sm-6 form-group">
                                        <label>Registration is for</label>
                                        <hr class="left" />
                                        <div class="form-check border py-1">
                                            <label>
                                                <input type='radio' name='chkPatient' value="0" onclick='fnPatient_onSelection();'>
                                                New Patient
                                            </label>
                                        </div>
                                        @if (Model.lst_Patient.Count > 0)
                                        {
                                            @foreach (var p in Model.lst_Patient)
                                            {
                                                <div class="form-check border py-1">
                                                    <label>
                                                        <input type='radio' name='chkPatient' value="@p.RUhid" onclick='fnPatient_onSelection();'>
                                                        @p.FirstName  @p.LastName (@p.RUhid.ToString())
                                                    </label>
                                                </div>
                                            }

                                        }
                                    </div>
                                }
                                <div class="col-lg-10 col-md-10 col-sm-10">

                                    <div class="row">
                                        <div class="col-lg-4 col-md-4 col-sm-6 form-group">
                                            <label>First Name</label>
                                            <input type="text" class="form-control" id="txtFirstName" value="@Model.FirstName" />
                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-6 form-group">
                                            <label>Last Name</label>
                                            <input type="text" class="form-control" id="txtLastName" value="@Model.LastName" />
                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-6">
                                            <div class="row">
                                                <div class="col-lg-5 col-md-5 col-sm-6 pr-0">
                                                    <div class="form-group">
                                                        <label for="txtDateOfBirth">DOB <span class="lblInfo"></span></label>
                                                        <input id="txtDateOfBirth" type="text" class="form-control datepicker" value="@Model.DateOfBirth" />
                                                    </div>
                                                </div>
                                                <div class="col-lg-1 col-md-1 col-sm-1  padtop20 pl-lg-0 pl-md-0 pr-0">
                                                    <label>(or)</label>
                                                </div>
                                                <div class="col-lg-6 col-md-6 col-sm-6 pl-0">
                                                    <div class="form-group">
                                                        <label class="d-block">Age <span class="lblInfo">(YY)</span></label>
                                                        <input id="txtAgeYY" type="text" class="form-control d-inline-block w-25" placeholder="YY" value="@Model.AgeYy" />
                                                    </div>
                                                </div>
                                            </div>

                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-6">
                                            <div class="form-group">
                                                <label for="">Gender</label>
                                                <select class="form-control " id="cboGender" data-container="body" disabled>
                                                    <option>Select</option>
                                                    <option value="M">Male</option>
                                                    <option value="F">Female</option>
                                                </select>
                                            </div>
                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-6 form-group">
                                            <label>Mobile Number</label>
                                            @await Component.InvokeAsync("IsdMobileInput", new { id = "MobileNo", value = @Model.MobileNumber })
                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-6 form-group">
                                            <label>Email ID</label>
                                            <input type="text" class="form-control" id="txtEmailId" value="@Model.EmailId" />
                                        </div>
                                        <div class="col-lg-4 col-md-4 col-sm-12">
                                            <div class="form-group">
                                                <label>Address</label>
                                                <textarea id="txtAddress" rows="4" class="form-control" value="@Model.Address">@Model.Address</textarea>
                                            </div>
                                        </div>
                                        <div class="col-lg-8 col-md-8 col-sm-12">
                                            <div class="row">
                                                <div class="col-lg-6 col-md-6 col-sm-6 form-group">
                                                    <label>Pincode</label>
                                                    <input type="text" name="number" class="form-control" pattern="[0-9]" maxlength="6" id="txtPincode" value=@Model.Pincode />
                                                </div>
                                                <div class="col-lg-6 col-md-6 col-sm-6 form-group">
                                                    <label>Area</label>
                                                    <select class="w-100 selectpicker" id="cboArea" data-size="8" data-live-search="true">
                                                        <option value="0">Select</option>
                                                    </select>
                                                </div>
                                                <div class="col-lg-6 col-md-6 col-sm-6 form-group">
                                                    <label>City</label>
                                                    <select class="w-100 selectpicker" id="cboCity" data-size="8" data-live-search="true" onchange="fncboCity_change()">
                                                        <option value="0">Select</option>
                                                    </select>
                                                </div>
                                                <div class="col-lg-6 col-lg-6 col-sm-6 form-group">
                                                    <label>State</label>
                                                    <select class="w-100 selectpicker" id="cboState" data-size="8" data-live-search="true" onchange="fncboState_change()">
                                                        <option value="0">Select</option>
                                                    </select>
                                                </div>
                                            </div>
                                        </div>

                                    </div>

                                    <div class="row">
                                        <div class="col-lg-4 col-md-4 col-sm-12 form-group">
                                            <div class="form-group">
                                                <label> @Localizer["Photo"] <span class="lblInfo"> (Only Jpg & png format)</span></label>
                                                <div class="imagedig" style="border:thin; padding-bottom:5px;" id="imgPhoto">
                                                    <img id="imgPhotoimageblah" src=@Model.ImageUrl>
                                                    <input class="mdl-textfield__input fullwidth FileUpload" id="Photoimage" type="file" name="file" onchange="readPhotoimage(this);" accept='image/*' enctype="multipart/form-data" style="border-bottom:none !important" />
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                </div>
                                <div class="col-lg-12 col-md-12 col-sm-12 text-center">
                                    <hr />
                                    <button class="btn btn-primary mb-1 float-right text-white p-1 btn-sm" id="btnprint" onclick="fnDownloadVoucher();"><i class="fa fa-download"></i> Download Voucher</button>
                                    <button type="button" class="btn btn-primary mr-2" id="btnUpdateCheckInGuest" onclick="fnSubmitForUpdate()"><i class="fa fa-sync"></i>Update</button>
                                    <button type="button" class="btn btn-primary mr-2" id="btnSubmitCheckInGuest" onclick="fnSubmitForCheckIn()"><i class="fa fa-check"></i> Confirm Guest Check-In</button>
                                    <button type="button" class="btn btn-primary" onclick="close_window();return false;"><i class="fa fa-times"></i> Close</button>
                                </div>
                            </div>
                        </form>
                    </div>

                    <div class="tab-pane fade" id="tab_documentupload" role="tabpanel" aria-labelledby="documentupload-tab">
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                                <table id="jqgDocumentUpload"></table>
                                <div id="jqpDocumentUpload"></div>
                            </div>
                        </div>
                    </div>

                    <div class="tab-pane fade" id="tab_guestDetails" role="tabpanel" aria-labelledby="guestDetails-tab">
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                                <table id="jqgGuestDetails"></table>
                                <div id="jqpGuestDetails"></div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="tab_IT" role="tabpanel" aria-labelledby="intertransfer-tab">
                        <div class="row">
                            <div class="col-lg-12 col-md-12 col-sm-12 p-0">
                                <ul class="nav nav-pills border-bottom" id="myTabIT" role="tablist">
                                    <li class="nav-item">
                                        <a class="nav-link active" id="rescheduling-tab" data-toggle="tab" href="#tab_rescheduling" role="tab" aria-controls="rescheduling" aria-selected="false" onclick="fnLoadITRescheduling()">Rescheduling</a>
                                    </li>
                                    <li class="nav-item">
                                        <a class="nav-link" id="bedtransfer-tab" data-toggle="tab" href="#tab_bedtransfer" role="tab" aria-controls="bedtransfer" aria-selected="true" onclick="fnLoadITBedTransfer()">Bed Transfer</a>
                                    </li>

                                    <li class="nav-item">
                                        <a class="nav-link" id="addonservices-tab" data-toggle="tab" href="#tab_addonservices" role="tab" aria-controls="addonservices" aria-selected="false" onclick="fnLoadITAddOnServices()">Add on Services</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                        <div class="tab-content" id="myTabITContent">

                            <div class="tab-pane fade  show active" id="tab_rescheduling" role="tabpanel" aria-labelledby="rescheduling-tab">
                                <div class="row">
                                    <div>
                                        <input type="text" class="form-control" value="" id="txtRSchedulserialnumber" style="display:none" />
                                    </div>
                                    <div class="col-lg-3 col-md-3 col-sm-6 col-12 form-group">
                                        <label>Check-in</label>
                                        <input type="text" class="form-control" name="checkin" value="" id="txtRschedulcheckindate" />
                                    </div>
                                    <div class="col-lg-3 col-md-3 col-sm-6 col-12 form-group">
                                        <label>Check-out</label>
                                        <input type="text" class="form-control" name="checkout" value="" id="txtRschedulcheckoutdate" />
                                    </div>
                                    <div class="col-lg-3 col-md-3 col-sm-6 col-12 form-group">
                                        <button type="button" class="btn btn-primary mr-2" id="btnSaveRSchedul" onclick="fnSaveGuestReScheduling()"><i class="fa fa-save"></i> Save</button>
                                    </div>
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                                        <table id="jqgITRescheduling"></table>
                                        <div id="jqpITRescheduling"></div>
                                    </div>


                                </div>
                            </div>

                            <div class="tab-pane fade" id="tab_bedtransfer" role="tabpanel" aria-labelledby="bedtransfer-tab">
                                <div class="row">
                                    <div>
                                        <input type="text" id="txtRChangeserialnumber" style="display:none" />
                                    </div>
                                    <div class="col-lg-3 col-md-3 col-sm-6 col-12 form-group">
                                        <label>Room Type</label>
                                        <select class="selectpicker" data-live-search="true" id="cboRoomTypeId" title="" data-size="8" data-container="body" onchange="fncboRoomType_change()">
                                            <option value="0"> Select</option>
                                            @if (ViewBag.roomtypes != null)
                                            {
                                                foreach (var room in ViewBag.roomtypes)
                                                {
                                                    <option value="@room.RoomTypeId">@room.RoomTypeDesc</option>
                                                }

                                            }
                                        </select>
                                    </div>
                                    <div class="col-lg-3 col-md-3 col-sm-6 col-12 form-group">
                                        <label>Room Number</label>
                                        <select class="selectpicker" data-live-search="true" id="cboRoomNumber" title="" data-container="body" data-size="8" onchange="fncboRoomNumber_change()">
                                            <option value="0"> Select</option>

                                        </select>
                                    </div>

                                    <div class="col-lg-3 col-md-3 col-sm-6 col-12 form-group">
                                        <label>Bed Number</label>
                                        <select class="selectpicker" data-live-search="true" id="cboBedNumber" title="" data-container="body" data-size="8">
                                            <option value="0"> Select</option>
                                        </select>
                                    </div>

                                    <div class="col-lg-3 col-md-3 col-sm-6 col-12 form-group">
                                        <div class="form-group">
                                            <label>Comments</label>
                                            <textarea id="txtComments" rows="1" class="form-control" value="" maxlength="500"></textarea>
                                        </div>
                                    </div>

                                    <div class="col-lg-3 col-md-3 col-sm-6 col-12 form-group">
                                        <button type="button" class="btn btn-primary mr-2" id="btnSaveRoomChange" onclick="fnSaveRoomChangeChange()"><i class="fa fa-save"></i> Save</button>
                                    </div>



                                    <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                                        <table id="jqgITBedTransfer"></table>
                                        <div id="jqpITBedTransfer"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="tab-pane fade" id="tab_addonservices" role="tabpanel" aria-labelledby="addonservices-tab">
                                <div class="row">
                                    <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                                        <table id="jqgITAddOnServices"></table>
                                        <div id="jqpITAddOnServices"></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div>

                    <div class="tab-pane fade" id="tab_payment" role="tabpanel" aria-labelledby="payment-tab">
                        <div class="row">
                            <div class="col-lg-2  col-md-2 col-sm-6">
                                <label class="text-right">Package Amount</label>
                                <input type="text" id="txtPackageAmount" class="form-control currencyFormat" onkeypress="return OnlyNumeric(event);" readonly style="text-align:right;width:100%" value="@Model.NetPackageAmount" />
                            </div>
                            <div class="col-lg-2  col-md-2 col-sm-6">
                                <label class="text-right">Net Bill Amount</label>
                                <input type="text" id="txtNetPackageAmount" class="form-control currencyFormat" onkeypress="return OnlyNumeric(event);" readonly style="text-align:right;width:100%" />
                            </div>
                            <div class="col-lg-2  col-md-2 col-sm-6">
                                <label class="text-right">Collected Amount</label>
                                <input type="text" id="txtCollectedAmount" class="form-control currencyFormat" onkeypress="return OnlyNumeric(event);" readonly style="text-align:right;width:100%" />
                            </div>
                            <div class="col-lg-2  col-md-2 col-sm-6">
                                <label class="text-right">Balance Amount</label>
                                <input type="text" id="txtBalanceAmount" class="form-control currencyFormat" onkeypress="return OnlyNumeric(event);" readonly style="text-align:right;width:100%" />
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-6" style="vertical-align:bottom;top:10px">
                                <button type="button" class="btn btn-sm btn-primary " style="font-size:12px !important" id="btnAdvancePayment" onclick="fnShowAddPaymentPopup()"><i class="fa fa-plus"></i> Add Payment</button>
                            </div>

                        </div>
                        <br />
                        <div class="row">
                            <div class="col-lg-10 col-md-10 col-sm-12 col-12">
                                <table id="jqgPaymentDetails"></table>
                                <div id="jqpPaymentDetails"></div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-lg-2 col-md-2 col-sm-6" style="vertical-align:bottom;top:10px">
                                <button type="button" class="btn btn-sm btn-primary " style="font-size:12px !important" id="btnRefundPayment" onclick="fnShowRefundPopup()"><i class="fa fa-minus"></i> Refund Payment</button>
                            </div>
                            <div class="col-lg-2 col-md-2 col-sm-6" style="vertical-align:bottom;top:10px;display:inline" >
                                <button type="button" class="btn btn-sm btn-primary " style="font-size:12px !important" id="btnRefundRequestPayment" onclick="fnShowRefundJournalPopup()"><i class="fa fa-minus"></i> Refund Request</button>
                            </div>
                        </div>
                    </div>
                    

                    <div class="tab-pane fade" id="tab_invoicebilling" role="tabpanel" aria-labelledby="invoicebilling-tab">
                        <div class="row">
                            <div class="col-lg-8 col-md-8 col-sm-12 col-12">
                                <table id="jqgGuestServiceBilling"></table>
                                <div id="jqpGuestServiceBilling"></div>
                            </div>

                            <div class="col-lg-4 col-md-4 col-sm-12 padbot10">
                                <div class="total-box  h-220 shadow-sm p-2">
                                    <h5 class="total-cash-heading bg-light py-2"><i class="fa fa-file-invoice"></i> Net Bill Amount</h5>

                                    <div class="row m-0">
                                        <label class="col-lg-6 pad-x-10 fontsize-12">Total Bill Amount</label>
                                        <div class="col-lg-6 pad-x-10">
                                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label fullwidth" style="padding-top:0px !important; padding-bottom:10px !important">
                                                <input type="text" id="txtTotalBillAmount" class="mdl-textfield__input   currencyFormat  text-right" readonly style="display:inline-block  ">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row m-0">
                                        <label class="col-lg-6 pad-x-10 fontsize-12">Total Discount Amount</label>
                                        <div class="col-lg-6 pad-x-10">
                                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label fullwidth" style="padding-top:0px !important; padding-bottom:10px !important">
                                                <input type="text" id="txtTotalDiscountAmount" class="mdl-textfield__input   currencyFormat  text-right" readonly style="display:inline-block  ">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row m-0">
                                        <label class="col-lg-6 pad-x-10 fontsize-12">Concession Amount</label>
                                        <div class="col-lg-6 pad-x-10">
                                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label fullwidth" style="padding-top:0px !important; padding-bottom:10px !important">
                                                <input type="text" id="txtTotalConcessionAmount" class="mdl-textfield__input currencyFormat  text-right" onkeypress="return OnlyNumeric(event);" onblur="fnConcesssionAmount_onLeave()">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row m-0">
                                        <label class="col-lg-6 pad-x-10 fontsize-12">Net Bill Amount</label>
                                        <div class="col-lg-6 pad-x-10">
                                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label fullwidth" style="padding-top:0px !important; padding-bottom:10px !important">
                                                <input type="text" id="txtNetBillAmount" class="mdl-textfield__input currencyFormat  text-right" readonly style="display:inline-block  ">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row m-0">
                                        <label class="col-lg-6 pad-x-10 fontsize-12">Collected Amount</label>
                                        <div class="col-lg-6 pad-x-10">
                                            <div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label fullwidth" style="padding-top:0px !important; padding-bottom:10px !important">
                                                <input type="text" id="txtTotalCollectedAmount" class="mdl-textfield__input currencyFormat  text-right" readonly style="display:inline-block  ">
                                            </div>
                                        </div>
                                    </div>
                                    <div class="row m-0">
                                        <label class="col-lg-6 pad-x-10 fontsize-12">Narration</label>
                                        <div class="col-lg-12 pad-x-10">
                                            <textarea rows="1" id="txtNarration" maxlength="250" class="form-control"></textarea>
                                        </div>
                                    </div>
                                </div>


                            </div>
                        </div>
                        <div class="col-lg-12 col-md-12 col-sm-12 text-center">
                            <hr />
                            <button type="button" class="btn btn-primary mr-2" id="btnSaveGuestBilling" onclick="fnSubmitGuestBilling()"><i class="fa fa-check"></i> Generate Invoice</button>
                        </div>

                    </div>

                    <div class="tab-pane fade" id="tab_guestcheckout" role="tabpanel" aria-labelledby="guestcheckout-tab">
                        <div class="steps" style="display:none">
                            <progress id="progress" value=0 max=100></progress>
                            <div class="step-item">
                                <div class="step-title">Booked on</div>
                                <button class="step-button text-center" type="button">
                                    <i class='fa fa-circle'></i>
                                </button>
                                <div class="step-title">

                                    <span class="dateTime">29-09-2022 06:30PM</span>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-title">Payment</div>
                                <button class="step-button text-center collapsed" type="button">
                                    <i class='fa fa-circle'></i>
                                </button>
                                <div class="step-title">
                                    <span class="dateTime">29-09-2022 06:30PM</span>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-title">Checked-in</div>
                                <button class="step-button text-center collapsed" type="button">
                                    <i class='fa fa-circle'></i>
                                </button>
                                <div class="step-title">
                                    <span class="dateTime">29-09-2022 06:30PM</span>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-title">Department Clearance</div>
                                <button class="step-button text-center collapsed" type="button">
                                    <i class='fa fa-circle'></i>
                                </button>
                                <div class="step-title">
                                    <span class="dateTime">29-09-2022 06:30PM</span>
                                </div>

                            </div>
                            <div class="step-item">
                                <div class="step-title">Invoice generated</div>
                                <button class="step-button text-center collapsed" type="button">
                                    <i class='fa fa-circle'></i>
                                </button>
                                <div class="step-title">
                                    <span class="dateTime">29-09-2022 06:30PM</span>
                                </div>
                            </div>
                            <div class="step-item">
                                <div class="step-title">Checked-out</div>
                                <button class="step-button text-center collapsed" type="button">
                                    <i class='fa fa-circle'></i>
                                </button>
                                <div class="step-title">
                                    <span class="dateTime">29-09-2022 06:30PM</span>
                                </div>
                            </div>
                        </div>
                        <br />

                        <div class="col-lg-12 col-md-12 col-sm-12 text-center">
                            <hr />
                            <button type="button" class="btn btn-primary mr-2" id="btCancelGuestBooking" onclick="fnGuestCancellationProcess()"><i class="fa fa-check"></i> Cancel Guest Booking </button>
                            <button type="button" class="btn btn-primary mr-2" id="btnSubmitGuestCheckOut" onclick="fnSubmitGuestCheckOutProcess()"><i class="fa fa-check"></i> Confirm Guest Check-Out </button>
                            <button type="button" class="btn btn-primary mr-2" id="btnPrintGuestInvoiceBill" onclick="fnPrintGuestInvoiceBill()"><i class="fa fa-check"></i> Print Invoice Bill</button>
                        </div>

                    </div>



                </div>
            </div>
        </div>
    </div>
</section>

<div class="modal fade" id="popupAddPayment" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modaltitle"><span id="dvPayment">Payment</span></h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="fa fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body" style="min-height:280px;  overflow: inherit !important">

                @await Html.PartialAsync("~/Areas/eSyaNatureCure/Views/CheckInGuest/_PaymentModeDetails.cshtml")

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary mr-2" id="btnSavePaymentRefund" onclick="fnSavePaymentRefund()"><i class="fa fa-check"></i> Save</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="popUpAddService" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modaltitle">Add Services</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="fa fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body" style="min-height:280px;  overflow: inherit !important">
                <div class="row">
                    <div class="col-lg-12 col-md-12 col-sm-12">
                        <label class="col-lg-6" style="padding-left:0px">Service Items</label>
                        <select class="selectpicker" data-size="5" data-live-search="true" id="cboBillingServices" title="" style="width:300px" onchange="fnBillingServicesChanged(this);">
                            <option value=0>Select</option>
                        </select>
                    </div>
                </div>
                <br />
                <div class="row m-0">
                    <div class="col-lg-6 col-md-6 col-sm-6">
                        <label class="fontsize-12">Service Amount</label>
                        <input type="text" id="txtServiceRate" class="mdl-textfield__input currencyFormat  text-right" readonly style="display:inline-block  ">
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary mr-2" id="btnAddServices" onclick="fnGridAddService()"><i class="fa fa-check"></i> Add Service</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
            </div>
        </div>
    </div>
</div>

<div class="modal fade in" id="PopupDocumentUpload" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-md  " role="document" style="box-shadow:none;">
        <div class="modal-content ">
            <div class="modal-header popupHeader">
                <button type="button" class="close ml-auto" data-dismiss="modal"> <i class="fa fa-times"></i></button>
                <h4 class="modal-title">@Localizer["AddDocument"]</h4>
            </div>

            <div class="modal-body">

                <div class="row padbot4">

                    <div class="col-lg-12" style="display:none">
                        <div class="form-group">
                            <div>
                                <label for="txtSerialNumber"> @Localizer["SerialNumber"]</label>
                                <input class="form-control" type="text" maxlength="9" id="txtSerialNumber" data-inputmask="'mask': '9', 'repeat': 10, 'greedy' : false" />

                            </div>
                        </div>
                    </div>

                    <div class="col-lg-12">
                        <div class="form-group">
                            <label for="txtDocumentName"> @Localizer["DocumentName"]</label>
                            <input id="txtDocumentName" class="form-control" maxlength="100" type="text" />

                        </div>
                    </div>

                    <div class="col-lg-12">
                        <div class="form-group">
                            <label for="txtIdentificationNumber"> Identification Number</label>
                            <input id="txtIdentificationNumber" class="form-control" maxlength="150" type="text" />

                        </div>
                    </div>
                </div>


                <div class="row">
                    <div class="col-lg-6  col-md-6 col-sm-12 col-xs-12 form-group">
                        <label> @Localizer["SelectDocument"] </label>
                        <div style="border:thin; padding-bottom:5px;">
                            <img src="" id="imagepath" width="100" height="100">
                            <input class="mdl-textfield__input fullwidth FileUpload" id="UploadPhotoimage" type="file" name="file" onchange="readDocumentimage(this);" accept='image/*' enctype="multipart/form-data" style="border-bottom:none !important" />

                        </div>

                    </div>
                </div>


                <div class="row">
                    <div class="col-lg-3  col-md-3 col-sm-12 col-xs-12">
                        <div class="default-checkbox">
                            <label class="mdl-checkbox mdl-js-checkbox mdl-js-ripple-effect" for="chkActiveStatus">
                                <input type="checkbox" id="chkActiveStatus" class="mdl-checkbox__input">
                                <span class="mdl-checkbox__label">@Localizer["Active"]</span>
                            </label>
                        </div>

                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-lg-12">
                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent primary-button" id="btnSaveDocumentUpload" onclick="fnSaveDocumentUpload()">
                            <i class="fa fa-save"></i> @Localizer["Save"]
                        </button>
                        @*<button type="button" class="btn btn-primary mr-2" id="btnSaveDocumentUpload" onclick="fnSaveDocumentUpload()"><i class="fa fa-sync"></i> @Localizer["Save"]</button>*@

                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect  cancel-button cancel-button" data-dismiss="modal" id="btnCancelDocumentUpload" onclick="fnClearDocumentUpload()"><i class="fa fa-times"></i> @Localizer["Cancel"] </button>


                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


<div class="modal fade" id="popUpITAddService" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
    <div class="modal-dialog modal-md">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="modaltitle">Add Services</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true"><i class="fa fa-times"></i></span>
                </button>
            </div>
            <div class="modal-body" style="min-height:280px;  overflow: inherit !important">
                <div class="row">
                    <div>
                        <input type="text" id="txtaddserviceSerialNumber" style="display:none" />
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6">
                        <label class="col-lg-6" style="padding-left:0px">Service</label>
                        <select class="selectpicker" data-size="5" data-live-search="true" id="cboServices" title="" style="width:300px" onchange="fnAddServicesChanged(this);">
                            <option value=0>Select</option>
                        </select>
                    </div>
                    <div class="col-lg-6 col-md-6 col-sm-6">
                        <label>Service Date</label>
                        <input type="text" class="form-control" name="checkin" value="" id="txtServicedate" />
                    </div>
                </div>
                <br />
                <div class="row m-0">
                    <div class="col-lg-6 col-md-6 col-sm-6">
                        <label class="fontsize-12">Quantity</label>
                        <input id="txtQuantity" class="form-control text-right" type="text" min="0" autocomplete="off" maxlength="8" data-inputmask="'mask': '9', 'repeat': 10, 'greedy' : false" />
                    </div>

                    <div class="col-lg-6 col-md-6 col-sm-6">
                        <label class="fontsize-12">Service Rate</label>
                        <input type="text" id="txtaddServiceRate" class="mdl-textfield__input currencyFormat  text-right" readonly style="display:inline-block">
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary mr-2" id="btnServices" onclick="fnSaveService()"><i class="fa fa-check"></i> Save</button>
                <button type="button" class="btn btn-primary" data-dismiss="modal"><i class="fa fa-times"></i> Close</button>
            </div>
        </div>
    </div>
</div>


<div class="modal fullscreen fade in" id="PopupGuestDetails" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-lg" role="document" style="box-shadow:none;">
        <div class="modal-content">
            <div class="modal-header popupHeader">
                <button type="button" class="close" data-dismiss="modal" onclick="fnClearUpdateGuestDetails()"> <i class="fa fa-times"></i></button>
                <h4 class="modal-title">Update Guest Details</h4>
            </div>

            <div class="modal-body">


                <div class="row">
                    <input type="hidden" id="hiddenGuestId" />
                    <input type="hidden" id="hiddenBookingKey" />
                    <div class="col-lg-4 col-md-4 col-sm-6 form-group">
                        <label>First Name</label>
                        <input type="text" class="form-control" id="txtGFirstName" maxlength="50" />
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6 form-group">
                        <label>Last Name</label>
                        <input type="text" class="form-control" id="txtGLastName" maxlength="50" />
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6">
                        <div class="row">
                            @*<div class="col-lg-5 col-md-5 col-sm-6 pr-0">
                                    <div class="form-group">
                                        <label for="txtGDateOfBirth">DOB <span class="lblInfo"></span></label>
                                        <input id="txtGDateOfBirth" type="text" class="form-control datepicker" />
                                    </div>
                                </div>*@
                            @*<div class="col-lg-1 col-md-1 col-sm-1  padtop20 pl-lg-0 pl-md-0 pr-0">
                                    <label>(or)</label>
                                </div>*@
                            <div class="col-lg-6 col-md-6 col-sm-6 pl-0">
                                <div class="form-group">
                                    <label class="d-block">Age <span class="lblInfo">(YY)</span></label>
                                    <input id="txtGAgeYY" type="text" class="form-control d-inline-block w-25" placeholder="YY" />
                                </div>
                            </div>
                        </div>

                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6">
                        <div class="form-group">
                            <label for="">Gender</label>
                            <select class="form-control " id="cboGGender" data-container="body" disabled>
                                <option value="0">Select</option>
                                <option value="M">Male</option>
                                <option value="F">Female</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6 form-group">
                        <label>Mobile Number</label>
                        @await Component.InvokeAsync("IsdMobileInput", new { id = "MobileGNo", value = @Model.MobileNumber })
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-6 form-group">
                        <label>Email ID</label>
                        <input type="text" class="form-control" id="txtGEmailId" maxlength="50" />
                    </div>
                    <div class="col-lg-4 col-md-4 col-sm-12">
                        <div class="form-group">
                            <label>Address</label>
                            <textarea id="txtGAddress" rows="4" class="form-control" maxlength="500"></textarea>
                        </div>
                    </div>
                    <div class="col-lg-8 col-md-8 col-sm-12">
                        <div class="row">
                            <div class="col-lg-6 col-md-6 col-sm-6 form-group">
                                <label>Pincode</label>
                                <input type="text" name="number" class="form-control" pattern="[0-9]" maxlength="6" id="txtGPincode" />
                            </div>
                            <div class="col-lg-6 col-lg-6 col-sm-6 form-group">
                                <label>State</label>
                                <select class="w-100 selectpicker" id="cboGState" data-size="4" data-live-search="true" onchange="fncboGState_change()">
                                    <option value="0">Select</option>
                                </select>
                            </div>

                            <div class="col-lg-6 col-md-6 col-sm-6 form-group">
                                <label>City</label>
                                <select class="w-100 selectpicker" id="cboGCity" data-size="4" data-live-search="true" onchange="fncboGCity_change()">
                                    <option value="0">Select</option>
                                </select>
                            </div>
                            <div class="col-lg-6 col-md-6 col-sm-6 form-group">
                                <label>Area</label>
                                <select class="w-100 selectpicker" id="cboGArea" data-size="4" data-live-search="true">
                                    <option value="0">Select</option>
                                </select>
                            </div>
                        </div>
                    </div>

                </div>

            </div>

            <div class="modal-footer">
                <div class="row">
                    <div class="col-lg-12">
                        <button type="button" class="btn btn-primary mr-2" id="btnUpdateGuestDetails" onclick="fnUpdateGuestDetails()"><i class="fa fa-sync"></i>Update</button>
                        <button type="button" class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect  cancel-button cancel-button" data-dismiss="modal" id="btnCancelUpdateGuestDetails" onclick="fnClearUpdateGuestDetails()"><i class="fa fa-times"></i> Close</button>
                    </div>
                </div>
            </div>
        </div>


    </div>
</div>


<div class="modal fade in" id="PopupReasonforCancellationAlert" data-keyboard="false" data-backdrop="static">
    <div class="modal-dialog modal-md  " role="document" style="box-shadow:none;">
        <div class="modal-content ">
            <div class="modal-header popupHeader">
                <button type="button" class="close ml-auto" data-dismiss="modal"> <i class="fa fa-times"></i></button>
                <h4 class="modal-title">@Localizer["Are you Sure to Cancel Guest Booking?"]</h4>
            </div>

            <div class="modal-body">

                <div class="row padbot4">



                    <div class="col-lg-12">
                        <div class="form-group">
                            <label for="txtReasonforCancellation"> @Localizer["Reason for Cancellation"]</label>
                            <input id="txtReasonforCancellation" class="form-control" maxlength="100" type="text" />

                        </div>
                    </div>

                </div>
            </div>
            <div class="modal-footer">
                <div class="row">
                    <div class="col-lg-12">
                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--accent primary-button" id="btnConfirmGuestCancellationProcess" onclick="fnConfirmGuestCancellationProcess();">
                            <i class="fa fa-save"></i> @Localizer["Yes"]
                        </button>
                        <button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect" onclick="fnCancelGuestCancellationProcess();"><i class="fa fa-times"></i> @Localizer["No"] </button>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@*<script src="~/js/jquery-3.6.0.min.js"></script>
    <script src="~/js/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.js"></script>
    <script src="~/js/i18n/grid.locale-en.js"></script>
    <script src="~/js/jquery.jqGrid.min.js"></script>
    <script type="text/javascript" src="~/js/all.min.js"></script>
    <script src="~/js/toastr.min.js"></script>*@

<script>

    var _cityCode, _areaCode;
    $(function () {




        setDate($('#txtDateOfBirth'), '@Model.DateOfBirth');

        var _ischeckedin = "@Model.IsCheckedIn";
        var _ischeckedOut = "@Model.IsCheckedOut";

        $('#lblBookingStatus').html("Booked");
        if (_ischeckedin == "True") {

            $("#btnUpdateCheckInGuest").attr('disabled', false);
            $('#btnUpdateCheckInGuest').show();

            $("#btnSubmitCheckInGuest").attr('disabled', true);
            $('#btnSubmitCheckInGuest').hide();

            $("#btnSubmitGuestCheckOut").attr('disabled', false);
            $('#btnSubmitGuestCheckOut').show();
            $('#lblBookingStatus,#statusInfoSection').show();
            $('#lblBookingStatus').html("Checked-In");
        }
        else
        {

            $("#btnUpdateCheckInGuest").attr('disabled', true);
            $('#btnUpdateCheckInGuest').hide();

            $('#btnSubmitCheckInGuest').show();
            $("#btnSubmitCheckInGuest").attr('disabled', false);

            $('#btnSubmitGuestCheckOut').hide();
            $("#btnSubmitGuestCheckOut").attr('disabled', true);
            $('#lblBookingStatus,#statusInfoSection').show();
        }

        if (_ischeckedOut == "True") {
            $('#btnSubmitGuestCheckOut').hide();
            $('#btCancelGuestBooking').hide();
            $('#lblBookingStatus').html("Checked-Out");
        }

        $('#cboGender').val('@Model.Gender');

        fnLoadGuestDetails();
      //  fnLoadPaymentDetails();
      //  fnLoadDocumentUpload();

        $("#alertmod_jqgActivities,#alertmod_jqgAddOnServices").css('display', 'none');

        _cityCode = '@Model.CityCode';
        _areaCode = '@Model.AreaCode';
        populateState();


    });

    $(document).ready(function () {

        $.contextMenu({
            // define which elements trigger this menu
            selector: "#btnCheckinDetailsPreview",
            trigger: 'left',
            // define the elements of the menu
            items: {
                jqgEdit: { name: localization.Edit, icon: "edit", callback: function (key, opt) { fnEditGuestCheckin(event, 'edit') } },
                jqgView: { name: localization.View, icon: "view", callback: function (key, opt) { fnGuestCheckin(event, 'view') } },
            }
            // there's more, have a look at the demos and docs...
        });
        $(".context-menu-icon-edit").html("<span class='icon-contextMenu'><i class='fa fa-pen'></i>" + localization.Edit + " </span>");
        $(".context-menu-icon-view").html("<span class='icon-contextMenu'><i class='fa fa-eye'></i>" + localization.View + " </span>");





        $.get(getBaseURL() + '/CheckInGuest/GetServiceList',
            function (data) {
                var s = '<option value="-1">select</option>';
                for (var i = 0; i < data.length; i++) {
                    s += '<option value="' + data[i].ServiceId + '">' + data[i].ServiceDesc + '</option>';
                }
                $("#cboBillingServices").html(s);
                $("#cboBillingServices").selectpicker('refresh');
            });

    });

    function close_window() {
        history.back();
        //if (confirm("Close Window?")) {
        //    close();
        //}
    }

    var _uhid = 0;
    function fnPatient_onSelection() {
        var chkPatient = $("input[name='chkPatient']:checked").val();
        if (chkPatient != "0") {
            _uhid = chkPatient;
            $('#hdUHID').val(chkPatient);
            getPatientInfo(chkPatient);
        }
    }

    function getPatientInfo(uhid) {
        $.get(getBaseURL() + '/CheckInGuest/GetPatientProfileByUHID', {
            uhid: uhid
        }, function (data, status) {
            $("#txtFirstName").val(data.FirstName);
            $("#txtLastName").val(data.LastName);
            $("#txtDateOfBirth").val(data.DateOfBirth);
            $("#txtAgeYY").val(data.AgeYY);
            $("#txtEmail").val(data.eMailID);
            if (data.CurrentPatientAddress != null) {
                $("#txtAddress").val(data.CurrentPatientAddress.Address);
                $("#cboState").val(data.CurrentPatientAddress.StateCode);
                $("#cboState").selectpicker("refresh");
                _cityCode = data.CurrentPatientAddress.CityCode;
                _areaCode = data.CurrentPatientAddress.AreaCode;
                fncboState_change();
                fncboCity_change();
                $("#txtPincode").val(data.CurrentPatientAddress.Pincode);
            }
        });
        return null;
    }

    function populateState() {
        $("#cboState").empty();
        $.get(getBaseURL() + '/CheckInGuest/GetStateList', {
            isdCode: _cnfISDCode
        }, function (data, status) {
            $.each(data, function (key, val) {
                $("#cboState").append($("<option></option>").val(val.PlaceId).html(val.PlaceName));
            });
            }).done(function () {
                var state = '@Model.StateCode';
                $('#cboState').val(state);
                $("#cboState").selectpicker('refresh');
                populateCity();
            });
    }

     function populateCity() {
         $("#cboCity").empty();
         $("#cboArea").empty();
         $.get(getBaseURL() + '/CheckInGuest/GetCityList', {
             isdCode: _cnfISDCode, stateCode: $("#cboState").val()
        }, function (data, status) {
            $.each(data, function (key, val) {
                $("#cboCity").append($("<option></option>").val(val.PlaceId).html(val.PlaceName));
            });
        }).done(function () {
            $('#cboCity').val(_cityCode);
            $("#cboCity").selectpicker('refresh');
            populateArea();
        });
    }

    function populateArea() {
        $("#cboArea").empty();
        $.get(getBaseURL() + '/CheckInGuest/GetAreaList', {
            isdCode: _cnfISDCode, stateCode: $("#cboState").val(), cityCode : $('#cboCity').val()
        }, function (data, status) {
            $.each(data, function (key, val) {
                $("#cboArea").append($("<option></option>").val(val.AreaCode).html(val.AreaName));
            });
        }).done(function () {
            $('#cboArea').val(_areaCode);
            $("#cboArea").selectpicker('refresh');
        });
    }

    function fncboState_change() {
        populateCity();
    }

    function fncboCity_change() {
        populateArea();
    }

    $("#txtPincode").blur(function () {
        $.get(getBaseURL() + '/CheckInGuest/GetAreaDetailsbyPincode', {
            isdCode: _cnfISDCode, pincode: $("#txtPincode").val()
        }, function (data, status) {
            $('#cboState').val(data.StateCode);
            $('#cboState').selectpicker('refresh');
            _cityCode = data.CityCode;
            _areaCode = data.AreaCode;
            populateCity();
        });
    });


    function fnSubmitForCheckIn() {

        if ($("input[name='chkPatient']:checked").val() === undefined) {
            toastr.error("Please select the Registration for");
            return;
        }

        if (IsStringNullorEmpty($("#cboMobileNo").val()) || $("#cboMobileNo").val() === "0") {
            toastr.warning("Please select Isd Code");
            return;
        }
        if (IsStringNullorEmpty($("#txtMobileNo").val())) {
            toastr.warning("Please Enter Mobile Number");
            return;
        }
        if (IsStringNullorEmpty($("#txtAddress").val())) {
            toastr.warning("Please Enter Address");
            return;
        }
        if (IsStringNullorEmpty($("#cboState").val()) || $("#cboState").val() === "0") {
            toastr.warning("Please select State");
            return;
        }
        if (IsStringNullorEmpty($("#cboArea").val()) || $("#cboArea").val() === "0") {
            toastr.warning("Please select Area");
            return;
        }
        if (IsStringNullorEmpty($("#cboCity").val()) || $("#cboCity").val() === "0") {
            toastr.warning("Please select City");
            return;
        }
        if (IsStringNullorEmpty($("#txtPincode").val())) {
            toastr.warning("Please Enter Pincode");
            return;
        }

        //var obj = {
        //    BookingKey: $('#hdBookingKey').val(),
        //    GuestId: $('#hdGuestId').val(),
        //    UHID: $('#hdUHID').val(),
        //    FirstName: $('#txtFirstName').val(),
        //    LastName: $('#txtLastName').val(),
        //    DateOfBirth: $("#txtDateOfBirth").val(),
        //    AgeYY: $("#txtAgeYY").val(),
        //    AgeMM: 0,
        //    AgeDD: 0,
        //    Isdcode: $("#cboMobileNo").val(),
        //    MobileNumber: $('#txtMobileNo').val(),
        //    EmailId: $('#txtEmailId').val(),
        //    Address: $('#txtAddress').val(),
        //    AreaCode: $("#cboArea").val(),
        //    CityCode: $("#cboCity").val(),
        //    StateCode: $("#cboState").val(),
        //    Pincode: $('#txtPincode').val(),
        //    Gender: $('#cboGender').val()
        //};
        var obj = new FormData();
        obj.append("Imagefile", $("#Photoimage").get(0).files[0]);
        obj.append("BookingKey", document.getElementById("hdBookingKey").value);
        obj.append("GuestId", document.getElementById("hdGuestId").value);
        obj.append("UHID", document.getElementById("hdUHID").value);
        obj.append("FirstName", document.getElementById("txtFirstName").value);
        obj.append("LastName", document.getElementById("txtLastName").value);
        obj.append("DateOfBirth", document.getElementById("txtDateOfBirth").value);
        obj.append("AgeYY", document.getElementById("txtAgeYY").value);
        obj.append("AgeMM", 0);
        obj.append("AgeDD", 0);
        obj.append("Isdcode", document.getElementById("cboMobileNo").value);
        obj.append("MobileNumber", document.getElementById("txtMobileNo").value);
        obj.append("EmailId", document.getElementById("txtEmailId").value);
        obj.append("Address", document.getElementById("txtAddress").value);
        obj.append("AreaCode", document.getElementById("cboArea").value);
        obj.append("CityCode", document.getElementById("cboCity").value);
        obj.append("StateCode", document.getElementById("cboState").value);
        obj.append("Pincode", document.getElementById("txtPincode").value);
        obj.append("Gender", document.getElementById("cboGender").value);
        obj.append("CheckedInDate", '@Model.CheckedInDate');
        obj.append("CheckedOutDate", '@Model.CheckedOutDate');
        


        $("#btnSubmitCheckInGuest").attr('disabled', true);

        var URL = getBaseURL() + '/CheckInGuest/CreateGuestCheckin';
        $.ajax({
            //url: URL,
            //type: 'POST',
            //datatype: 'json',
            //contenttype: 'application/json; charset=utf-8',
            //data: obj,
            //async: true,
            url: URL,
            type: "POST",
            data: obj,
            dataType: "json",
            contentType: false,
            processData: false,
            success: function (response) {
                if (response.Status) {
                    toastr.success("Guest Checked-In");
                    location.reload();
                }
                else {
                    toastr.error(response.Message);
                }
                $("#btnSubmitCheckInGuest").attr('disabled', false);
            },
            error: function (error) {
                toastr.error(error.statusText);
                $("#btnSubmitCheckInGuest").attr('disabled', false);
            }
        });
    }

    function fnLoadGuestDetails()
    {
        $("#jqgGuestDetails").GridUnload();

        $("#jqgGuestDetails").jqGrid({
            url: getBaseURL() + '/CheckInGuest/GetGuestDetailsByBookingKey',
            datatype: "json",
            contenttype: "application/json; charset-utf-8",
            mtype: 'GET',
            postData: {
                bookingKey: function () { return parseInt($('#hdBookingKey').val()) },
            },
            jsonReader: { repeatitems: false, root: "rows", page: "page", total: "total", records: "records" },
            colNames: ["@Localizer["Guest Id"]", "@Localizer["First Name"]", "@Localizer["Last Name"]", "@Localizer["Gender"]", "@Localizer["Age YY"]", "@Localizer["Mobile Number"]", "@Localizer["Room Type"]", "@Localizer["Room No"]", "@Localizer["Bed No"]", "@Localizer["Price"]",@*"Date of Birth",*@ "","","","","","","","","","","","", "@Localizer["Action"]"],
            colModel: [
                { name: "GuestId", width: 40, editable: false, editoptions: { disabled: true }, align: 'left', edittype: 'text', hidden: true },
                { name: "FirstName", width: 150, editable: true, align: 'left', edittype: 'text', hidden: false },
                { name: "LastName", width: 150, editable: true, align: 'left', edittype: 'text', hidden: false },
                { name: "Gender", width: 70, editable: true, align: 'left', edittype: 'text', hidden: false },
                { name: "AgeYy", width: 70, editable: true, align: 'left', edittype: 'text', hidden: false },
                { name: "MobileNumber", width: 160, editable: true, align: 'left', edittype: 'text', hidden: false },
                { name: "RoomTypeName", width: 120, editable: true, align: 'left', edittype: 'text', hidden: false },
                { name: "RoomNumber", width: 80, editable: true, align: 'left', edittype: 'text', hidden: false },
                { name: "BedNumber", width: 80, editable: true, align: 'left', edittype: 'text', hidden: false },
                { name: 'PackagePrice', index: 'PackagePrice', width: '120', align: "right", formatter: 'integer', formatoptions: { decimalSeparator: ".", decimalPlaces: 2, thousandsSeparator: ',' } },
                //{
                //    name: "Button", width: 100, editable: false, align: 'left', hidden: false, formatter: function (cellValue, options, rowObject) {
                //        var i = options.rowId;
                //        return "<button id=btnCheckin_" + i + " type='button'  class='btn btn-primary' onclick=fnGuestCheckin('" + rowObject.GuestId + "') >  View </button >";
                //    }
                //},
                //{
                //    name: 'DateOfBirth', index: 'DateOfBirth', width: 60, sorttype: "date", formatter: "date", formatoptions:
                //        { newformat: _cnfjqgDateFormat }, hidden: true
                //},
                { name: "BookingKey", width: 160, editable: true, align: 'left', edittype: 'text', hidden: true },
                { name: "Isdcode", width: 160, editable: true, align: 'left', edittype: 'text', hidden: true },
                { name: "EmailId", width: 160, editable: true, align: 'left', edittype: 'text', hidden: true },
                { name: "Place", width: 160, editable: true, align: 'left', edittype: 'text', hidden: true },
                { name: "UHID", width: 160, editable: true, align: 'left', edittype: 'text', hidden: true },
                { name: "Address", width: 160, editable: true, align: 'left', edittype: 'text', hidden: true },
                { name: "AreaCode", width: 160, editable: true, align: 'left', edittype: 'text', hidden: true },
                { name: "CityCode", width: 160, editable: true, align: 'left', edittype: 'text', hidden: true },
                { name: "StateCode", width: 160, editable: true, align: 'left', edittype: 'text', hidden: true },
                { name: "Pincode", width: 160, editable: true, align: 'left', edittype: 'text', hidden: true },
                { name: "IsCheckedIn", width: 35, editable: false, align: 'center', edittype: "checkbox", formatter: 'checkbox', editoptions: { value: "true:false" }, formatoptions: { disabled: true }, hidden: true},
                { name: "IsCheckedOut", width: 35, editable: false, align: 'center', edittype: "checkbox", formatter: 'checkbox', editoptions: { value: "true:false" }, formatoptions: { disabled: true }, hidden: true },

                {
                    name: 'edit', search: false, align: 'left', width: 50, sortable: false, resizable: false,
                    formatter: function (cellValue, options, rowdata, action) {
                        return '<button class="mr-1 btn btn-outline" id="btnCheckinDetailsPreview"><i class="fa fa-ellipsis-v"></i></button>'
                    }
                },
            ],
            //rowNum: 10,
            //pager: "#jqpGuestDetails",
            //rownumWidth: 55,
            //viewrecords: true,
            //gridview: true,
            //rownumbers: true,
            //height: 'auto',
            //width: 'auto',
            //autowidth: true,
            //shrinkToFit: true,
            //forceFit: true,
            //loadonce: true,
            //loadBeforeSend: function () {
            //    $("#jqgh_jqgGuestDetails_PackagePrice").css('text-align', 'right');
            //},
            //loadComplete: function (data) {
            //},
            pager: "#jqpGuestDetails",
            rowNum: 10,
            rowList: [10, 20, 50, 100],
            rownumWidth: '55',
            loadonce: true,
            viewrecords: true,
            gridview: true,
            rownumbers: true,
            height: 'auto',
            scroll: false,
            width: 'auto',
            autowidth: true,
            shrinkToFit: true,
            forceFit: true, caption: 'GuestDetails',
            loadComplete: function (data) {
                 fnJqgridSmallScreen("jqgGuestDetails");
            },
            onSelectRow: function (rowid, status, e) {
                var $self = $(this), $target = $(e.target),
                    p = $self.jqGrid("getGridParam"),
                    rowData = $self.jqGrid("getLocalRow", rowid),
                    $td = $target.closest("tr.jqgrow>td"),
                    iCol = $td.length > 0 ? $td[0].cellIndex : -1,
                    cmName = iCol >= 0 ? p.colModel[iCol].name : "";

                switch (cmName) {
                    case "id":
                        if ($target.hasClass("myedit")) {
                            alert("edit icon is clicked in the row with rowid=" + rowid);
                        } else if ($target.hasClass("mydelete")) {
                            alert("delete icon is clicked in the row with rowid=" + rowid);
                        }
                        break;
                    case "serial":
                        if ($target.hasClass("mylink")) {
                            alert("link icon is clicked in the row with rowid=" + rowid);
                        }
                        break;
                    default:
                        break;
                }

            },



        }).jqGrid('navGrid', '#jqpGuestDetails', { add: false, edit: false, search: false, del: false, refresh: false, refreshtext: 'Reload' }).jqGrid('navButtonAdd', '#jqpGuestDetails', {
                caption: '<span class="fa fa-sync"></span> Refresh', buttonicon: "none", id: "custRefresh", position: "first", onClickButton: fnGridRefreshUpdateGuestDetails
            });
    }

    function fnGuestCheckin() {

        var Growid = $("#jqgGuestDetails").jqGrid('getGridParam', 'selrow');
        var GrowData = $('#jqgGuestDetails').jqGrid('getRowData', Growid);

        var url = getBaseURL() + '/eSyaNatureCure/CheckInGuest/V_ENC_04_00?bookingKey=' + $('#hdBookingKey').val() + '&guestId=' + GrowData.GuestId;
        window.location.href = url;
    }



    function fnSetBillSummaryAmount() {

          //$.get(getBaseURL() + '/CheckInGuest/GetGuestBillingSummary?bookingKey=' + parseInt($('#hdBookingKey').val()),
          //  function (data) {
          //      $("#txtPackageAmount").val(data.PackageAmount);
          //      $("#txtNetPackageAmount").val(data.NetBillAmount);
          //  });

        $.ajax({
            url: getBaseURL() + '/CheckInGuest/GetGuestBillingSummary?bookingKey=' + parseInt($('#hdBookingKey').val()),
            async: false,
            success: function (data) {
                $("#txtPackageAmount").val(data.PackageAmount);
                $("#txtNetPackageAmount").val(data.NetBillAmount);
            }
        });
    }

    function fnLoadPaymentDetails() {


        $("#btnAdvancePayment").attr('disabled', true);

        fnSetBillSummaryAmount();

        $("#jqgPaymentDetails").GridUnload();

        $("#jqgPaymentDetails").jqGrid({
            url: getBaseURL() + '/CheckInGuest/GetGuestPaymentReceiptDetails',
            datatype: "json",
            contenttype: "application/json; charset-utf-8",
            mtype: 'GET',
            postData: {
                bookingKey: function () { return parseInt($('#hdBookingKey').val()) },
            },
            jsonReader: { repeatitems: false, root: "rows", page: "page", total: "total", records: "records" },
            colNames: ["@Localizer["Voucher Type"]", "@Localizer["Voucher Type Desc"]","@Localizer["Payment Mode"]", "@Localizer["Voucher Key"]", "@Localizer["Voucher Date"]", "@Localizer["Voucher Amount"]"],
            colModel: [
                { name: "VoucherType", width: 40, editable: false, editoptions: { disabled: true }, align: 'left', edittype: 'text', hidden: true },
                { name: "VoucherTypeDesc", width: 150, editable: true, align: 'left', edittype: 'text', hidden: false },
                { name: "PaymentModeDesc", width: 260, editable: true, align: 'left', edittype: 'text', hidden: false },

                { name: "VoucherKey", width: 180, editable: true, align: 'left', edittype: 'text', editoptions: { maxlength: 50 }, hidden: false },
                {
                    name: 'VoucherDate', index: 'VoucherDate', width: 180, sortable: true, formatter: "date", formatoptions:{ newformat: _cnfjqgDateFormat }, width: '100'
                },
                { name: 'VoucherAmount', index: 'VoucherAmount', width: '170', align: "right", formatter: 'integer', formatoptions: { decimalSeparator: ".", decimalPlaces: 2, thousandsSeparator: ',' } },
            ],
            rowNum: 10,
            pager: "#jqpPaymentDetails",
            rownumWidth: 55,
            viewrecords: true,
            gridview: true,
            rownumbers: true,
            height: 'auto',
            width: 'auto',
            autowidth: true,
            shrinkToFit: true,
            forceFit: true,
            loadonce: true,
            loadComplete: function (data) {
                var totalCollectionAmount = 0;
                var rowIds = $("#jqgPaymentDetails").getDataIDs();
                for (var i = 0; i < rowIds.length; i++) {
                    if ($("#jqgPaymentDetails").jqGrid('getCell', rowIds[i], 'VoucherType') == "R")
                        totalCollectionAmount = totalCollectionAmount + Math.round(parseFloat($("#jqgPaymentDetails").jqGrid('getCell', rowIds[i], 'VoucherAmount')));
                    else if ($("#jqgPaymentDetails").jqGrid('getCell', rowIds[i], 'VoucherType') == "P")
                        totalCollectionAmount = totalCollectionAmount - Math.round(parseFloat($("#jqgPaymentDetails").jqGrid('getCell', rowIds[i], 'VoucherAmount')));
                }
                CalculateTotalAmount();
                var netBillAmount = parseFloat($('#txtNetPackageAmount').val());
                //if (netBillAmount <= 0) {
                //    netBillAmount = parseFloat($('#txtPackageAmount').val());
                //}
                //$('#txtNetPackageAmount').val(netBillAmount.toFixed(2));
                var balanceAmount = netBillAmount - totalCollectionAmount;
                $('#txtCollectedAmount').val(totalCollectionAmount.toFixed(2));
                $('#txtTotalCollectedAmount').val(totalCollectionAmount.toFixed(2));
                $('#txtBalanceAmount').val(balanceAmount.toFixed(2));

                fnAddGridSerialNoHeading();

                if (balanceAmount > 0)
                    $("#btnAdvancePayment").attr('disabled', false);
            },
        }).jqGrid('navGrid', '#jqpPaymentDetails', { add: false, edit: false, search: false, del: false, refresh: false });

    }

    var _voucherType = "";
    function fnShowAddPaymentPopup() {
        _voucherType = "R";
        $('#dvPayment').html('Payment');
        $('#popupAddPayment').modal('show');
    }

    function fnShowRefundPopup() {
        _voucherType = "P";
        $('#dvPayment').html('Refund');
        $('#popupAddPayment').modal('show');
    }

    function fnShowRefundJournalPopup() {
        _voucherType = "J";
        $('#dvPayment').html('Request for Refund');
        $('#popupAddPayment').modal('show');
    }

    function fnLoadBillingServices() {
        fnLoadGuestBillingServices();
    }

    function fnLoadGuestBillingServices() {
        $("#jqgGuestServiceBilling").jqGrid("GridUnload");
        $("#jqgGuestServiceBilling").jqGrid(
            {
                url: getBaseURL() + '/CheckInGuest/GetGuestServiceBilling',
                datatype: "json",
                contenttype: "application/json; charset-utf-8",
                mtype: 'GET',
                postData: {
                    bookingKey: function () { return parseInt($('#hdBookingKey').val()) },
                },
                jsonReader: { repeatitems: false, root: "rows", page: "page", total: "total", records: "records" },
                colNames: ['Service Code', 'Service Description','Qty','Rate', 'Discount', 'Net Amount'],
                colModel: [
                    { name: 'ServiceCode', index: 'ServiceCode', width: '100', hidden: true },
                    { name: 'ServiceName', index: 'ServiceName', width: '300' },
                    { name: 'Quantity', index: 'Quantity', width: '80', align: "right", editable: true, formatter: 'integer', formatoptions: { decimalSeparator: ".", decimalPlaces: 0, thousandsSeparator: ',' } },
                    { name: 'Rate', index: 'Rate', width: '120', align: "right", editable: false, formatter: 'integer', formatoptions: { decimalSeparator: ".", decimalPlaces: 0, thousandsSeparator: ',' } },
                    { name: 'DiscountAmount', index: 'DiscountAmount', width: '100', align: "right", formatter: 'integer', formatoptions: { decimalSeparator: ".", decimalPlaces: 2, thousandsSeparator: ',' } },
                    { name: 'TotalAmount', index: 'TotalAmount', width: '150', align: "right", formatter: 'integer', formatoptions: { decimalSeparator: ".", decimalPlaces: 2, thousandsSeparator: ',' } },
                ],
                rowNum: 10,
                rownumWidth:55,
                pager: "#jqpGuestServiceBilling",
                viewrecords: true,
                gridview: true,
                rownumbers: true,
                height: 'auto',
                width: 'auto',
                autowidth: true,
                shrinkToFit: true,
                forceFit: true,
                loadonce: true,
                editurl: 'url',
                cellsubmit: 'clientArray',
                cellEdit: true,
                loadBeforeSend: function () {
                    $("#jqgh_jqgGuestServiceBilling_Quantity").css('text-align', 'right');
                },
                loadComplete: function () {
                    fnAddGridSerialNoHeading();
                },
                gridComplete: function () {
                    CalculateTotalAmount();
                },
                beforeEditCell: function (rowid, cellname, value, iRow, iCol) {
                    var rowData = $("#jqgGuestServiceBilling").getRowData(rowid);
                    if (iRow === 1) {
                        $("#jqgGuestServiceBilling").removeClass('edit-cell').setCell(rowid, 'Quantity', '', 'not-editable-cell');
                        $("#jqgGuestServiceBilling").trigger("reloadGrid", [{ fromServer: false }]);
                    }
                },
                afterSaveCell: function (rowid, cellname, value, iRow, iCol) {
                    var rowData = $("#jqgGuestServiceBilling").getRowData(rowid);

                    var quantity = 0, rate = 0, discountAmount = 0, totalAmount = 0;
                    quantity = parseFloat(rowData.Quantity);
                    rate = parseFloat(rowData.Rate);

                    discountAmount = parseFloat(rowData.DiscountAmount);
                    totalAmount = (quantity * rate) - discountAmount;

                    $("#jqgGuestServiceBilling").jqGrid('setCell', rowid, 'TotalAmount', totalAmount);
                    CalculateTotalAmount();

                }
            }).jqGrid('navGrid', '#jqpGuestServiceBilling', {
                add: false, edit: false, search: false, del: false, refresh: false
            }).jqGrid('navButtonAdd', '#jqpGuestServiceBilling', {
                caption: '<span class="fa fa-plus" data-toggle="modal" data-whatever="something" style="padding-right:5px;padding-top:2px;padding-right: 2px; vertical-align:text-top;margin-left:8px;"></span> Add', buttonicon: 'none', id: 'custAdd', position: 'first', onClickButton: fnAddService
            }).jqGrid('navButtonAdd', '#jqpGuestServiceBilling', {
                caption: '<span class="fa fa-trash" data-toggle="modal"  data-whatever="something" style="padding-right:5px;padding-top:2px;padding-right: 2px; vertical-align:text-top;margin-left:8px;"></span> Delete', buttonicon: 'none', id: 'custDelete', position: 'last', onClickButton: fnDeleteService
            });

        jQuery("#jqgGuestServiceBilling").trigger('reloadGrid');
    }


    function fnBillingServicesChanged(event) {
        $("#txtServiceRate").val(0);
        $.get(getBaseURL() + '/CheckInGuest/GetServiceRates?serviceId=' + $("#cboBillingServices").val(),
            function (data) {
                $("#txtServiceRate").val(data.ServiceRate);
            });
    }

    function fnAddService() {
        $("#popUpAddService").modal('show');
    }

    function fnDeleteService() {
        var rowId = jQuery("#jqgGuestServiceBilling").jqGrid('getGridParam', 'selrow');
        if (rowId != 1)
            jQuery("#jqgGuestServiceBilling").delRowData(rowId);
    }

    function fnGridAddService() {
        if (IsStringNullorEmpty($("#cboBillingServices").val()) || $("#cboBillingServices").val() <= 0) {
            toastr.warning("please select the service");
            return;
        }
        var gdData = { ServiceCode: $("#cboBillingServices").val(), ServiceName: $("#cboBillingServices").find("option:selected").text(), Quantity: "1", Rate: $("#txtServiceRate").val(), TotalAmount: $("#txtServiceRate").val() };
        var rowIds = $("#jqgGuestServiceBilling").getDataIDs();
        jQuery("#jqgGuestServiceBilling").addRowData(rowIds.length + 1, gdData);
        $("#popUpAddService").modal('hide');
    }

    function CalculateTotalAmount() {
        var quantity = 0;
        var rate = 0;
        var totalAmount = 0;
        var discountAmount = 0;
        var netBillAmount = 0;

        var rowIds = $("#jqgGuestServiceBilling").getDataIDs();
        for (var i = 0; i < rowIds.length; i++) {
            quantity = parseFloat($("#jqgGuestServiceBilling").jqGrid('getCell', rowIds[i], 'Quantity'));
            rate = parseFloat($("#jqgGuestServiceBilling").jqGrid('getCell', rowIds[i], 'Rate'));
            discountAmount += parseFloat($("#jqgGuestServiceBilling").jqGrid('getCell', rowIds[i], 'DiscountAmount'));
            //totalAmount += parseFloat($("#jqgGuestServiceBilling").jqGrid('getCell', rowIds[i], 'TotalAmount'));
            totalAmount += quantity * rate;
        }

        $('#txtTotalBillAmount').val(totalAmount.toFixed(2));
        $('#txtTotalDiscountAmount').val(discountAmount.toFixed(2));
        var concessionAmount = 0;
        if (!$.isEmptyObject($("#txtTotalConcessionAmount").val()) && $("#txtTotalConcessionAmount").val().length > 0) {
            concessionAmount = parseFloat($('#txtTotalConcessionAmount').val()).toFixed(2);
        }
        else {
            $('#txtTotalConcessionAmount').val(0);
        }

        if (concessionAmount > totalAmount) {
            $('#txtTotalConcessionAmount').val(0);
            concessionAmount = 0;
        }
        $('#txtTotalConcessionAmount').val(concessionAmount);

        netBillAmount = totalAmount - discountAmount - concessionAmount;

        $('#txtNetBillAmount').val(netBillAmount);
       // $('#txtNetPackageAmount').val(netBillAmount);

    }

    function fnConcesssionAmount_onLeave() {
        CalculateTotalAmount();
    }

    function fnSubmitGuestBilling() {
        if (parseFloat($("#txtTotalConcessionAmount").val()) > 0) {
            if ($("#txtNarration").val().length <= 1) {
                alert("please enter the narration for discount");
                return;
            }
        }

        $("#btnSaveGuestBilling").prop('disabled', true);
        var l_Services = [];
        var gvServices = jQuery("#jqgGuestServiceBilling").jqGrid('getRowData');
        for (var i = 0; i < gvServices.length; ++i) {
            var serv = {};
            serv.ServiceCode = gvServices[i]['ServiceCode'];
            serv.Quantity = parseFloat(gvServices[i]['Quantity']);
            serv.Rate = parseFloat(gvServices[i]['Rate']);
            serv.DiscountAmount = parseFloat(gvServices[i]['DiscountAmount']);
            serv.ConcessionAmount = 0;
            serv.TotalAmount = parseFloat(gvServices[i]['TotalAmount']);
            serv.PayableByPatient = parseFloat(gvServices[i]['TotalAmount']);
            serv.PayableByInsurance = 0;
            serv.ChargableToPatient = true;
            l_Services.push(serv);
        }
        var obj_PatientBillHeader = {
            BookingKey: $('#hdBookingKey').val(),
            UHID: $('#hdUHID').val(),
            OPNumber: 0,
            PackageId: $('#hdPackageId').val(),
            TransCurrencyCode: "INR",
            LocalCurrencyCode: "INR",
            ExchangeRate: 1,
            ConcessionOn:"N",
            TotalBillAmount : $('#txtTotalBillAmount').val(),
            TotalDiscountAmount: $('#txtTotalDiscountAmount').val(),
            TotalConcessionAmount : $('#txtTotalConcessionAmount').val(),
            RoundOff : 0,
            NetBillAmount : $('#txtNetBillAmount').val(),
            Narration: $('#txtNarration').val(),
            l_PatientBillDetails: l_Services,
        }

        var URL = getBaseURL() + '/CheckInGuest/CreateGuestBill';
        $.ajax({
            url: URL,
            type: 'POST',
            datatype: 'json',
            contenttype: 'application/json; charset=utf-8',
            data: obj_PatientBillHeader,
            async: true,
            success: function (response) {
                if (response.Status) {
                    toastr.success("Guest Bill Generated.");
                }
                else {
                    toastr.error(response.Message);
                }
                $("#btnSaveGuestBilling").attr('disabled', false);
            },
            error: function (error) {
                toastr.error(error.statusText);
                $("#btnSaveGuestBilling").attr('disabled', false);
            }
        });

    }


    function fnLoadGuestCheckOut() {

    }

    function fnGuestCancellationProcess() {
        $("#PopupReasonforCancellationAlert").modal('show');
        $("#btCancelGuestBooking").attr('disabled', false);
        $("#btnConfirmGuestCancellationProcess").attr('disabled', false);
        $('#txtReasonforCancellation').val('');

    }
    function fnCancelGuestCancellationProcess() {
        $("#PopupReasonforCancellationAlert").modal('hide');
        $("#btCancelGuestBooking").attr('disabled', false);
        $("#btnConfirmGuestCancellationProcess").attr('disabled', false);

    }
    function fnConfirmGuestCancellationProcess()
    {
        if (IsStringNullorEmpty($("#txtReasonforCancellation").val())) {
            toastr.warning("Please Enter Reason for Cancellation the Booking");
            return;
        }

        //$("#btCancelGuestBooking").prop('disabled', true);
        $("#btnConfirmGuestCancellationProcess").attr('disabled', true);
        var obj = {
            BookingKey: $('#hdBookingKey').val(),
            ReasonforCancellation: $('#txtReasonforCancellation').val(),
        }

        var URL = getBaseURL() + '/CheckInGuest/GuestBookingCancellationProcess';
        $.ajax({
            url: URL,
            type: 'POST',
            datatype: 'json',
            contenttype: 'application/json; charset=utf-8',
            data: obj,
            async: true,
            success: function (response) {
                if (response.Status) {
                    toastr.success("Guest Booking has been cancelled Successfully.");
                    $("#PopupReasonforCancellationAlert").modal('hide');

                }
                else {
                    toastr.error(response.Message);
                }
                $("#btnConfirmGuestCancellationProcess").attr('disabled', false);
            },
            error: function (error) {
                toastr.error(error.statusText);
                $("#btnConfirmGuestCancellationProcess").attr('disabled', false);
            }
        });
    }
    function fnSubmitGuestCheckOutProcess() {

        $("#btnSubmitGuestCheckOut").prop('disabled', true);

        var obj = {
            BookingKey: $('#hdBookingKey').val(),
            Isdcode: $("#cboMobileNo").val(),
            MobileNumber: $('#txtMobileNo').val(),
            FirstName: $('#txtFirstName').val(),
            LastName: $('#txtLastName').val()
        }

        var URL = getBaseURL() + '/CheckInGuest/GuestCheckOutProcess';
        $.ajax({
            url: URL,
            type: 'POST',
            datatype: 'json',
            contenttype: 'application/json; charset=utf-8',
            data: obj,
            async: true,
            success: function (response) {
                if (response.Status) {
                    toastr.success("Guest Checked Out Successfully.");
                    $('#btnSubmitGuestCheckOut').hide();
                    $('#btCancelGuestBooking').hide();
                    $('#lblBookingStatus').html("Checked-Out");
                }
                else {
                    toastr.error(response.Message);
                }
                $("#btnSubmitGuestCheckOut").attr('disabled', false);
            },
            error: function (error) {
                toastr.error(error.statusText);
                $("#btnSubmitGuestCheckOut").attr('disabled', false);
            }
        });

    }


    function fnPrintGuestInvoiceBill() {

        $.get(getBaseURL() + '/CheckInGuest/GetGuestCheckOutStatus?bookingKey=' + $('#hdBookingKey').val() + '&guestId=' + $('#hdGuestId').val(),
            function (data) {
                if (data.Status)
                    window.open(getReportBaseURL() + '/eSyaNatureCure/ReportViewer/GuestInvoiceBill?businessKey=' + 111 + '&bookingKey=' + $('#hdBookingKey').val(), "popupWindow", "width=700,height=800,scrollbars=yes");
                else {
                    toastr.warning("Bill Print will be enable after checkout process is completed.");
                }
            });


    }

    function fnDownloadVoucher() {
        window.open(getReportBaseURL() + '/eSyaNatureCure/ReportViewer/BookingVoucher?businessKey=' + 111 + '&bookingKey=' + $('#hdBookingKey').val(), "popupWindow", "width=700,height=800,scrollbars=yes");
    }

    function fnSubmitForUpdate() {

        if (IsStringNullorEmpty($("#cboMobileNo").val()) || $("#cboMobileNo").val() === "0") {
            toastr.warning("Please select Isd Code");
            return;
        }
        if (IsStringNullorEmpty($("#txtMobileNo").val())) {
            toastr.warning("Please Enter Mobile Number");
            return;
        }
        if (IsStringNullorEmpty($("#txtAddress").val())) {
            toastr.warning("Please Enter Address");
            return;
        }
        if (IsStringNullorEmpty($("#cboState").val()) || $("#cboState").val() === "0") {
            toastr.warning("Please select State");
            return;
        }
        if (IsStringNullorEmpty($("#cboArea").val()) || $("#cboArea").val() === "0") {
            toastr.warning("Please select Area");
            return;
        }
        if (IsStringNullorEmpty($("#cboCity").val()) || $("#cboCity").val() === "0") {
            toastr.warning("Please select City");
            return;
        }
        //if (IsStringNullorEmpty($("#txtPincode").val())) {
        //    toastr.warning("Please Enter Pincode");
        //    return;
        //}

        //var obj = {
        //    BookingKey: $('#hdBookingKey').val(),
        //    GuestId: $('#hdGuestId').val(),
        //    UHID: $('#hdUHID').val(),
        //    FirstName: $('#txtFirstName').val(),
        //    LastName: $('#txtLastName').val(),
        //    DateOfBirth: $("#txtDateOfBirth").val(),
        //    AgeYY: $("#txtAgeYY").val(),
        //    AgeMM: 0,
        //    AgeDD: 0,
        //    Isdcode: $("#cboMobileNo").val(),
        //    MobileNumber: $('#txtMobileNo').val(),
        //    EmailId: $('#txtEmailId').val(),
        //    Address: $('#txtAddress').val(),
        //    AreaCode: $("#cboArea").val(),
        //    CityCode: $("#cboCity").val(),
        //    StateCode: $("#cboState").val(),
        //    Pincode: $('#txtPincode').val(),
        //    Gender: $('#cboGender').val()
        //};
        var obj = new FormData();
        obj.append("Imagefile", $("#Photoimage").get(0).files[0]);
        obj.append("BookingKey", document.getElementById("hdBookingKey").value);
        obj.append("GuestId", document.getElementById("hdGuestId").value);
        obj.append("UHID", document.getElementById("hdUHID").value);
        obj.append("FirstName", document.getElementById("txtFirstName").value);
        obj.append("LastName", document.getElementById("txtLastName").value);
        obj.append("DateOfBirth", document.getElementById("txtDateOfBirth").value);
        obj.append("AgeYY", document.getElementById("txtAgeYY").value);
        obj.append("AgeMM", 0);
        obj.append("AgeDD", 0);
        obj.append("Isdcode", document.getElementById("cboMobileNo").value);
        obj.append("MobileNumber", document.getElementById("txtMobileNo").value);
        obj.append("EmailId", document.getElementById("txtEmailId").value);
        obj.append("Address", document.getElementById("txtAddress").value);
        obj.append("AreaCode", document.getElementById("cboArea").value);
        obj.append("CityCode", document.getElementById("cboCity").value);
        obj.append("StateCode", document.getElementById("cboState").value);
        obj.append("Pincode", document.getElementById("txtPincode").value);
        obj.append("Gender", document.getElementById("cboGender").value);


        $("#btnUpdateCheckInGuest").attr('disabled', true);

        var URL = getBaseURL() + '/CheckInGuest/UpdateGuestCheckin';
        $.ajax({
            //url: URL,
            //type: 'POST',
            //datatype: 'json',
            //contenttype: 'application/json; charset=utf-8',
            //data: obj,
            //async: true,
            url: URL,
            type: "POST",
            data: obj,
            dataType: "json",
            contentType: false,
            processData: false,
            success: function (response) {
                if (response.Status) {
                    toastr.success(response.Message);
                    location.reload();
                }
                else {
                    toastr.error(response.Message);
                }
                $("#btnUpdateCheckInGuest").attr('disabled', false);
            },
            error: function (error) {
                toastr.error(error.statusText);
                $("#btnUpdateCheckInGuest").attr('disabled', false);
            }
        });
    }
</script>


<script>
    const stepButtons = document.querySelectorAll('.step-button');
    const progress = document.querySelector('#progress');

    Array.from(stepButtons).forEach((button, index) => {
        button.addEventListener('click', () => {
            progress.setAttribute('value', index * 100 / (stepButtons.length - 1));//there are 3 buttons. 2 spaces.

            stepButtons.forEach((item, secindex) => {
                if (index > secindex) {
                    item.classList.add('done');
                    item.innerHTML = "<i class='fa fa-check'></i>"
                }
                if (index < secindex) {
                    item.classList.remove('done');
                    item.innerHTML = "<i class='fa fa-circle'></i>"
                }
            })
        })
    })
</script>


<script>

    var sizeLimit = 1024 * 2;

    function readPhotoimage(input) {
        if (input.files && input.files[0]) {

            var sizeInMb = input.files[0].size / 1024;

            if (!(input.files[0].type.match(/image.*/))) {
                toastr.warning("Invalid format file uploaded");
                input.value = null;
                return;
            }
            if (sizeInMb > sizeLimit) {
                toastr.warning("User Photo file size should be smaller than 2 MB");
                input.value = null;
                return;
            }

            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('imgPhotoimageblah').src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    function readDocumentimage(input) {
        if (input.files && input.files[0]) {

            var sizeInMb = input.files[0].size / 1024;


            if (sizeInMb > sizeLimit) {
                toastr.warning("Document file size should be smaller than 2 MB");
                input.value = null;
                return;
            }

            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('imagepath').src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }
    function readDSimage(input) {
        if (input.files && input.files[0]) {

            var sizeInMb = input.files[0].size / 1024;

            if (!(input.files[0].type.match(/image.*/))) {
                toastr.warning("Invalid format file uploaded");
                input.value = null;
                return;
            }
            if (sizeInMb > sizeLimit) {
                toastr.warning("file size should be smaller than 2 MB");
                input.value = null;
                return;
            }

            var reader = new FileReader();
            reader.onload = function (e) {
                document.getElementById('imgDSimageblah').src = e.target.result;
            }
            reader.readAsDataURL(input.files[0]);
        }
    }

</script>

